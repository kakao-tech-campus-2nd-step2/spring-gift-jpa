# spring-gift-wishlist

## step 1
> 상품을 추가하거나 수정하는 경우, 클라이언트로부터 잘못된 값이 전달될 수 있다. 잘못된 값이 전달되면 클라이언트가 어떤 부분이 왜 잘못되었는지 인지할 수 있도록 응답을 제공한다. 
> - 상품 이름은 공백을 포함하여 최대 15자까지 입력할 수 있다.
> - 특수 문자
>   - 가능: ( ), [ ], +, -, &, /, _
>   - 그 외 특수 문자 사용 불가
>   - "카카오"가 포함된 문구는 담당 MD와 협의한 경우에만 사용할 수 있다.

### 유효성 검사
1. 상품 이름
    - 공백을 포함하여 최대 15자
    - 특수 문자 일부 사용 가능
        - ( ), [ ], +, -, &, /, _ 
    - "카카오"가 포함된 문구 사용 불가
2. 상품 가격
    - 0 이상의 정수

### 예외 처리
1. 글자수 초과
   - message: "상품 이름은 15자 이하로 입력해주세요."
2. 사용하지 못하는 특수문자 포함
   - message: "사용할 수 없는 특수문자가 포함되어 있습니다."
3. "카카오" 포함
   - message: "상품 이름에 '카카오'를 포함할 수 없습니다. 담당 MD와 협의 후 사용해주세요."
4. 가격이 0 이하
   - message: "상품 가격은 0 이상의 정수로 입력해주세요."
   
---

## step 2
> 사용자가 로그인하고 사용자별 기능을 사용할 수 있도록 구현한다. 
> 아래 예시와 같이 HTTP 메시지를 주고받도록 구현한다.
> #### Request
> ```
> POST /login/token HTTP/1.1
> content-type: application/json
> host: localhost:8080
> {
> "password": "password",
> "email": "admin@email.com"
> }
> ```
> #### Response
> ```
> HTTP/1.1 200
> Content-Type: application/json
> {
> "accessToken": ""
> }


### 데이터베이스 테이블: User

| 필드명  | 데이터 타입 | 설명                 | 기타 조건        |
|--------|-------------|---------------------|----------------|
| id     | Long        | 회원 고유 식별자       | Primary Key, 자동 생성 |
| email  | String      | 회원 이메일           | Unique         |
| password | String    | 비밀번호            |                 |
| role | String     | 회원 권한 (USER, ADMIN)   | 기본값: USER    |
| status | Boolean     | 회원 활성화 상태      | 기본값: true    |

### 로그인 방식
- 로그인 방식: JWT 토큰
- 사용 기술: jjwt 라이브러리

### 로그인
1. 클라이언트가 email, password를 담은 request 전송
2. email로 User 조회
3. 조회된 User의 password와 request의 password 비교
4. 비밀번호가 일치하면 User에 대한 accessToken 발급
5. 비밀번호가 일치하지 않으면 에러 메세지 전송

### 로그인 처리 절차
1. 클라이언트 요청: 사용자가 이메일과 비밀번호를 포함한 로그인 요청을 서버로 전송
2. 사용자 조회: 요청된 이메일을 기반으로 데이터베이스에서 사용자 정보 조회
3. 비밀번호 검증: 조회된 사용자 정보의 비밀번호와 요청된 비밀번호를 비교
4. JWT 생성: 비밀번호가 일치하면 사용자의 고유 식별자(id)를 포함한 JWT를 생성
5. 응답 반환:
   - 비밀번호가 일치하면, 생성된 JWT를 accessToken 필드에 포함하여 클라이언트에 반환
   - 비밀번호가 일치하지 않으면, 로그인 불가 오류 메시지와 함께 401 Unauthorized 응답을 반환
6. 로그인 후 인증: 
   - 클라이언트는 반환된 JWT를 이후 요청의 Authorization 헤더에 포함하여 인증
   - 서버는 JWT를 검증하여 사용자 인증, 권한 확인 후 요청 처리

### 권한이 필요한 API
- '카카오' 키워드가 포함된 상품 추가
  - 관리자 권한을 가진 사용자라면 '카카오' 키워드가 포함된 상품을 추가할 수 있다.
  - 권한이 없다면 상품을 추가할 수 없도록 한다.

---

## step 3
> ### 기능 요구 사항
> 이전 단계에서 로그인 후 받은 토큰을 사용하여 사용자별 위시 리스트 기능을 구현한다.
> - 위시 리스트에 등록된 상품 목록을 조회할 수 있다.
> - 위시 리스트에 상품을 추가할 수 있다.
> - 위시 리스트에 담긴 상품을 삭제할 수 있다.
> ### 실행 결과
>사용자 정보는 요청 헤더의 Authorization 필드를 사용한다.
> - Authorization: <유형> <자격증명>
>   - ```Authorization: Bearer token```


### 데이터베이스 테이블: Wish
| 필드명       | 데이터 타입  | 설명           | 기타 조건                   |
|-----------|---------|--------------|-------------------------|
| id        | Long    | 위시리스트 고유 식별자 | Primary Key, 자동 생성      |
| userId    | Long    | 회원 고유 식별자    | AppUser 테이블의 id 참조 (FK) |
| productId | Long    | 상품 고유 식별자    | Product 테이블의 id 참조 (FK) |
| quantity  | int     | 상품 수량        | 기본값: 1                  |
| is_active    | Boolean | 상품의 활성화 상태   | 기본값: true               |

### 공통
- 모든 위시 리스트 관련 요청은 사용자 토큰을 요구한다.
   - **Header 사용:** `Authorization: Bearer <token>`

### 위시 리스트 조회
- **USER 권한:** 자신의 위시 리스트만 조회 가능
- **ADMIN 권한:** 모든 사용자의 위시 리스트 조회 가능
- **응답 데이터:** 특정 appUser id로 위시 리스트에 등록된 상품 목록

### 상품 추가
- **USER 권한:** 자신의 위시 리스트에 상품 추가 가능
- **ADMIN 권한:** 어느 사용자의 위시 리스트에도 상품 추가 가능

### 상품 수량 수정
- **USER 권한:** 자신의 위시 리스트에서 상품 수량 수정 가능
- **ADMIN 권한:** 어느 사용자의 위시 리스트에서도 상품 수량 수정 가능

### 상품 삭제
- **USER 권한:** 자신의 위시 리스트에서 상품 삭제 가능
- **ADMIN 권한:** 어느 사용자의 위시 리스트에서도 상품 삭제 가능