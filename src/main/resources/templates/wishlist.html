<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Wishlist</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    .btn {
      display: inline-block;
      padding: 10px 20px;
      margin: 5px;
      text-align: center;
      text-decoration: none;
      color: white;
      background-color: #4CAF50;
      border-radius: 5px;
    }
    .btn-secondary {
      background-color: #f44336;
    }
    .btn-home {
      margin-left: 20px;
      background-color: #007bff;
      color: white;
    }
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }
    .pagination .page-btn {
        background-color: #f1f1f1;
        border: none;
        padding: 10px;
        margin: 0 5px;
        cursor: pointer;
        border-radius: 5px;
        width: 50px;
        text-align: center;
    }
    .pagination .current-page {
        background-color: #4CAF50;
        color: white;
        border: 2px solid #4CAF50;
        border-radius: 5px;
        width: 50px;
        text-align: center;
    }
    .sort-buttons {
        display: flex;
        align-items: center;
        margin-left: 20px;
    }
    .sort-buttons .sort-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 80px;
        height: 40px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        margin-left: 10px;
        text-align: center;
        text-decoration: none;
    }
    .sort-buttons .sort-btn span {
        margin-left: 5px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>My Wishlist
    <a href="/web/products/list" class="btn btn-home">홈</a>
  </h1>
  <div class="sort-buttons">
    <a th:href="@{'/web/wishlist'(sort='productName', direction=${direction == 'asc' ? 'desc' : 'asc'}, page=${currentPage}, size=${pageSize})}" class="sort-btn">
      Name<span th:text="${sort == 'productName' ? (direction == 'asc' ? '↑' : '↓') : ''}"></span>
    </a>
    <a th:href="@{'/web/wishlist'(sort='price', direction=${direction == 'asc' ? 'desc' : 'asc'}, page=${currentPage}, size=${pageSize})}" class="sort-btn">
      Price<span th:text="${sort == 'price' ? (direction == 'asc' ? '↑' : '↓') : ''}"></span>
    </a>
    <a th:href="@{'/web/wishlist'(sort='quantity', direction=${direction == 'asc' ? 'desc' : 'asc'}, page=${currentPage}, size=${pageSize})}" class="sort-btn">
      Quantity<span th:text="${sort == 'quantity' ? (direction == 'asc' ? '↑' : '↓') : ''}"></span>
    </a>
  </div>
  <table>
    <thead>
    <tr>
      <th>Product Name</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Image</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="wishlist : ${wishlistPage.content}">
      <td th:text="${wishlist.productName}"></td> <!-- WishlistDTO의 productName -->
      <td th:text="${wishlist.price}"></td> <!-- WishlistDTO의 price -->
      <td>
        <input type="number" min="1" th:value="${wishlist.quantity}" class="quantity" style="width: 60px;"> <!-- WishlistDTO의 quantity -->
      </td>
      <td><img th:src="${wishlist.imageUrl}" alt="product image" width="100"/> <!-- WishlistDTO의 imageUrl -->
      <td>
        <button class="btn update-quantity" th:data-wishlist-id="${wishlist.id}">수량 변경</button> <!-- WishlistDTO의 id -->
        <button class="btn btn-secondary delete-wishlist" th:data-wishlist-id="${wishlist.id}">삭제</button> <!-- WishlistDTO의 id -->
      </td>
    </tr>
    </tbody>
  </table>

  <div class="pagination">
    <a th:if="${wishlistPage.hasPrevious()}"
       th:href="@{'/web/wishlist'(page=${currentPage - 1}, size=${pageSize}, sort=${sort}, direction=${direction})}"
       class="page-btn">Prev</a>

    <span th:each="i : ${#numbers.sequence(0, wishlistPage.totalPages - 1)}">
        <a th:href="@{'/web/wishlist'(page=${i}, size=${pageSize}, sort=${sort}, direction=${direction})}"
           th:text="${i + 1}"
           th:classappend="${i == currentPage} ? 'current-page' : ''"
           class="page-btn"></a>
    </span>

    <a th:if="${wishlistPage.hasNext()}"
       th:href="@{'/web/wishlist'(page=${currentPage + 1}, size=${pageSize}, sort=${sort}, direction=${direction})}"
       class="page-btn">Next</a>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll('.update-quantity').forEach(function(button) {
          button.addEventListener('click', function() {
              const wishlistId = this.getAttribute('data-wishlist-id');
              const quantityInput = this.closest('tr').querySelector('.quantity');
              const quantity = quantityInput.value;
              fetch(`/web/wishlist/update/${wishlistId}`, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/x-www-form-urlencoded'
                  },
                  body: new URLSearchParams({quantity: quantity})
              })
              .then(response => response.text())
              .then(data => alert(data))
              .catch(error => console.error('Error:', error));
          });
      });

      document.querySelectorAll('.delete-wishlist').forEach(function(button) {
          button.addEventListener('click', function() {
              const wishlistId = this.getAttribute('data-wishlist-id');
              fetch(`/web/wishlist/delete/${wishlistId}`, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/x-www-form-urlencoded'
                  }
              })
              .then(response => response.text())
              .then(data => {
                  alert(data);
                  window.location.reload();
              })
              .catch(error => console.error('Error:', error));
          });
      });
  });
</script>
</body>
</html>
