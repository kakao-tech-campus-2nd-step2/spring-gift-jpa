<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
  <head>
    <meta http-equiv="Content-Type" , content="text/html; charset=UTF-8" />
    <link th:href="@{/css/main.css}" rel="stylesheet" />
    <script th:src="@{/js/main.js}" type="text/javascript"></script>
    <title>Edit Page</title>
  </head>
  <header>
    <span class="title y-middle x-start">Edit Page</span>
    <div id="buttons" class="x-end y-middle">
      <button type="button" class="normal-buttons" onclick="loadMainPage()">
        뒤로 가기
      </button>
    </div>
  </header>
  <body>
    <table id="products" class="x-middle">
      <caption class="title">
        제품 정보 변경하기
      </caption>
      <colgroup>
        <col />
        <col />
        <col />
        <col />
      </colgroup>
      <thead>
        <tr>
          <th>Name</th>
          <th>Price</th>
          <th>Image</th>
          <th>Control</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span th:text="${product.name}">Name</span></td>
          <td><span th:text="${product.price}">Price</span></td>
          <td><span th:text="${product.imageUrl}">Image</span></td>
          <td><span>이전 정보</span></td>
        </tr>
        <tr>
          <td>
            <input
              type="text"
              name="name"
              id="name"
              th:value="${product.name}"
            />
          </td>
          <td>
            <input
              type="number"
              name="price"
              id="price"
              th:value="${product.price}"
            />
          </td>
          <td>
            <input
              type="text"
              name="imageUrl"
              id="imageUrl"
              th:value="${product.imageUrl}"
            />
          </td>
          <td>
            <button
              type="button"
              class="normal-buttons"
              th:onclick="|updateProduct(${product.productId})|"
            >
              정보 변경
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <script th:inline="javascript">
      async function updateProduct(productId) {
        const targetUrl = `/api/products/${productId}`;
        const headers = { 'Content-Type': 'application/json' };
        const name = document.getElementById('name').value;
        const price = document.getElementById('price').value;
        const imageUrl = document.getElementById('imageUrl').value;
        const body = JSON.stringify({
          name: name,
          price: price,
          imageUrl: imageUrl,
        });
        const method = 'put';

        const result = await requestApi(targetUrl, headers, body, method);

        if (result.response) {
          if (result.response == 'success') {
            loadMainPage();
          } else {
            alert(result.response);
          }
        } else {
          alert('알 수 없는 에러가 발생했습니다.');
        }
      }

      function loadMainPage() {
        const targetUrl = '/admin/main';
        const headers = {};
        requestView(targetUrl, headers);
      }
    </script>
  </body>
</html>
